> 主要根据小林coding中的MySQL部分内容进行摘录、笔记、总结

# MySQL
## 目录
* 基础篇
* 索引篇
* 事务篇
* 锁篇
* 日志篇
* 内存篇
* 数据库相关情景题

## 1. 基础篇
### 1.1 执行一条SQL查询语句，期间发生了什么？
##### MySQL基本结构
要知道执行一条SQL语句执行期间发生了什么需要先对MySQL的结构有一个基本的认知。
MySQL的架构分为两层：server层和存储引擎层。
**server层功能**
>**负责建立连接、分析和执行SQL**。MySQL大多数的核心功能都在这实现，主要包括连接器、查询缓存、解析器、预处理器、优化器、执行器等。另外，所有的内置函数(如日期、时间、数学和加密函数等)和所有跨存储引擎的功能(如存储过程、触发器、视图等)都在sever层实现。

**存储引擎层**
>**负责数据的存储和提取**。支持InnoDB、MyISAM、Memory等多个存储引擎，不同的存储引擎公用一个sever层。现在最常用的存储引擎是InnoDB，从MySQL5.5版本开始InnoDB成为了MySQL的默认存储引擎。我们常说的索引数据结构，就是存储引擎层实现的，不同的存储引擎支持的索引类型也不相同，比如InnoDB支持索引类型是B+树，且是默认使用，也就是说在数据表中创建的主键索引和二级索引默认使用的是B+索引。

#### SQL语句执行流程
一条依据的SQL的语句的执行流程如下： \
总共有四步： \
1 连接器--》2查询缓存--》3解析SQL语句--》4 执行SQL \
* step1 使用连接器与客户端进行连接 \
客户端是通过tcp与MySQL的连接器进行连接的，如果用户密码都没问题，连接器就会获取用户权限，然后保存起来，后续该用户在次连接里的任何操作，都会基于连接开始时读取到的权限进行权限逻辑判断。 、
所以如果一个用户如果已经建立了连接，及时管理员中途修改了该用户的权限，也不会影响已经存在连接的权限。修改完成后，只有再新建的连接才会使用新的连接权限。 
**关于连接器相关的问题**
>1. 如何查看MySQL服务被多少个客户端连接了？ \
> 2. 空闲连接会一直占用吗？
> 3. MySQL的连接数有限制吗？
> 4. 怎么解决长连接占用内存的问题？
 

2. 查询缓存
现根据第一个字段判断是什么类型得SQL语句，如果是查询语句(select 语句)，MySQL会先去查询缓存，看看之前有没有执行过这一条语句。 \
MySQL8.0版本直接将查询缓存删掉了，如果在这个版本之前想关闭查询缓存，可通过将query_cache_type设置成DEMAND \
另外这里得查询缓存是server层的，并不是InnoDB中的Buffer Pool

3. 解析器
在正式执行SQL语句之前，需要先进行解析，这由解析器来完成。 、
解析器做两件事：词法分析、语法分析--》构建语法树 、
注意：
表不存在或者字段不存在并不是解析器判断，而是在执行器中进行的。


4. 执行SQL
执行SQL的阶段可以细分为三个小阶段: \
* 预处理阶段， prepare阶段
* 优化阶段，optimize阶段
* 执行阶段， execute阶段

1) 预处理阶段 \
主要是预处理器进行操作，需要做两件事：
- 检查SQL语句中的表或字段是否存在
- 将select \*中的\*符号，扩展为表上的所有列

2) 优化阶段 \
预处理完之后需要为SQL语句先指定一个**执行计划**，这是由优化器完成。 \
比如说优化器会基于查询成本的考虑，来决定选择使用哪个索引。\
* 可以使用explain命令加在查询语句前来查看SQL语句的执行计划





### 1.2 MySQL一行记录是怎么存储的？





## 2. 索引篇
## 3. 锁篇
## 4. 日志篇
## 5. 内存篇
## 6. 情景题篇





